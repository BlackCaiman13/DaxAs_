<ion-header collapse="fade">
  <ion-toolbar>
    <ion-title >Notifications</ion-title>
    <ion-buttons slot="end">
      <ion-icon name="notifications-outline" style="font-size: 1.5rem; margin-right: 0.5rem;"></ion-icon>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" style="background: #fff;">
  <div>
    @if (loading) {
      <div class="loading-container" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem;">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Chargement des notifications...</p>
      </div>
    } @else if (notifications.length === 0) {
      <div class="empty-state" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 3rem 2rem; text-align: center;">
        <ion-icon name="notifications-outline" size="large" style="font-size: 4rem; color: #bdbdbd; margin-bottom: 1rem;"></ion-icon>
        <h2 style="color: #232323; margin: 0.5rem 0;">Aucune notification</h2>
        <p style="color: #6b6b6b;">Vous n'avez pas encore de notifications</p>
      </div>
    } @else {
      <ion-list lines="none">
        @for (notif of notifications; track notif.id) {
          <ion-item-sliding #slidingItem>
            <ion-item style="background: #fafbfc; align-items: flex-start; --padding-start: 1rem; --inner-padding-end: 1rem;">
              <ion-icon [name]="getNotificationIcon(notif)" slot="start" [style.color]="getNotificationColor(notif)" style="font-size: 1.3rem; margin-top: 0.2rem;"></ion-icon>
              <ion-label>
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                  <span style="font-weight: bold; color: #232323; font-size: 1.05rem;">{{notif.title}}</span>
                  <span style="font-size: 0.85rem; color: #bdbdbd; white-space: nowrap;">{{getTimeAgo(notif.created_at)}}
                    @if (!notif.is_read) {
                      <span style="display: inline-block; width: 0.5rem; height: 0.5rem; background: #4d5ef2; border-radius: 50%; margin-left: 0.3rem;"></span>
                    }
                  </span>
                </div>
                <div style="color: #6b6b6b; font-size: 0.97rem; margin-top: 0.3rem;">{{notif.message}}</div>
              </ion-label>
            </ion-item>

            <ion-item-options side="end">
              @if (!notif.is_read) {
                <ion-item-option (click)="markAsRead(slidingItem, notif)" color="primary" style="--padding-start: 1rem; --padding-end: 1rem;">
                  <ion-icon slot="icon-only" name="checkmark-outline"></ion-icon>
                </ion-item-option>
              }
              <ion-item-option (click)="deleteNotification(slidingItem, notif)" color="danger" style="--padding-start: 1rem; --padding-end: 1rem;">
                <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
              </ion-item-option>
            </ion-item-options>

          </ion-item-sliding>
        }
      </ion-list>
    }
  </div>
</ion-content>
