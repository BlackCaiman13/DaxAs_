<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/home"></ion-back-button>
    </ion-buttons>
    <ion-title style="text-align: center; font-weight: bold; font-size: 1.3rem;">Nouvelle Demande</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" style="background: #fff;">
  <div style="padding: 1.2rem 1rem;">
    <!-- Indicateur de progression -->
    <div style="display: flex; justify-content: center; gap: 0.5rem; margin-bottom: 2rem;">
      @for (i of [1, 2, 3]; track i) {
        <div [ngStyle]="{
          'width': '0.5rem',
          'height': '0.5rem',
          'border-radius': '50%',
          'background-color': i <= currentStep ? '#4d5ef2' : '#e9eaf0'
        }"></div>
      }
    </div>

    <form [formGroup]="requestForm">
      <!-- Étape 1: Détails de l'appareil -->
      @if (currentStep === 1) {
        <div>
          <h2 style="font-weight: bold; font-size: 1.2rem; margin-bottom: 1rem;">Détails de l'appareil</h2>
          
          <ion-item style="--padding-start: 0; margin-bottom: 1rem;">
            <ion-label position="stacked">Type d'appareil</ion-label>
            <ion-select aria-label="Fruit" interface="popover" placeholder="Selectionnez un type d'appareil">
            <ion-select-option value="apples">Smartphone</ion-select-option>
            <ion-select-option value="oranges">Ordinateur</ion-select-option>
            <ion-select-option value="bananas">Tablette</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item style="--padding-start: 0; margin-bottom: 1rem;">
            <ion-label position="stacked">Modèle</ion-label>
            <ion-input formControlName="model"  ></ion-input>
          </ion-item>

          <div >
            <h3 style="font-weight: 500; margin-bottom: 0.5rem;">Ajouter des photos</h3>

            <!-- Grille des photos sélectionnées -->
            @if (selectedPhotos.length > 0) {
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-bottom: 1rem;">
                @for (photo of selectedPhotos; track $index) {
                  <div style="position: relative; aspect-ratio: 1;">
                    <img [src]="photo" style="width: 100%; height: 100%; object-fit: cover; border-radius: 0.5rem;">
                    <button (click)="removePhoto($index)" style="position: absolute; top: -0.5rem; right: -0.5rem; background: #ff4444; color: white; border: none; border-radius: 50%; width: 1.5rem; height: 1.5rem; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                      <ion-icon name="close-outline" style="font-size: 1rem;"></ion-icon>
                    </button>
                  </div>
                }
              </div>
            }

            <!-- Bouton d'ajout de photo -->
            @if (selectedPhotos.length < 6) {
              <div style="border: 2px dashed #e9eaf0; border-radius: 0.5rem; padding: 1rem; text-align: center; cursor: pointer;" (click)="addPhoto()">
                <ion-icon name="camera-outline" style="font-size: 2rem; color: #6b6b6b;"></ion-icon>
                <div style="color: #6b6b6b; margin-top: 0.5rem;">Ajouter une photo</div>
              </div>
            }
          </div>
        </div>
      }

      <!-- Étape 2: Détails de localisation -->
      @if (currentStep === 2) {

        <div>
          <h2 style="font-weight: bold; font-size: 1.2rem; margin-bottom: 1rem;">Description du problème</h2>
          <p style="color: #6b6b6b; margin-bottom: 1rem;">Décrivez le problème en détail. Soyez aussi précis que possible.</p>

          <ion-item style="--padding-start: 0; margin-bottom: 0.5rem;">
            <ion-label position="stacked">Quel est le problème avec l'appareil ?</ion-label>
            <ion-textarea 
              formControlName="problemDescription"
              [maxlength]="500"
              rows="4">
            </ion-textarea>
          </ion-item>
          <div style="text-align: right; color: #6b6b6b; font-size: 0.8rem;">
            {{requestForm.get('problemDescription')?.value?.length || 0}}/500 characters
          </div>
        </div>

        
      }

      <!-- Étape 3: Description du problème -->
      @if (currentStep === 3) {
        <div>
          <h2 style="font-weight: bold; font-size: 1.2rem; margin-bottom: 1rem;">Détails de localisation</h2>
          <p style="color: #6b6b6b; margin-bottom: 1rem;">Spécifiez les détails de votre emplacement ou partagez votre position et choisissez la date de collecte.</p>

          <ion-item style="--padding-start: 0; margin-bottom: 1rem;">
            <ion-label position="stacked">Mon emplacement</ion-label>
            <ion-input formControlName="location"></ion-input>
          </ion-item>

          <ion-item style="--padding-start: 0; margin-bottom: 1rem;">
            <ion-label position="stacked">Détails de l'emplacement</ion-label>
            <ion-input formControlName="locationDetails"></ion-input>
          </ion-item>

          
            <!-- <ion-button fill="outline" (click)="getCurrentLocation()" style="flex: 1; --border-radius: 0.5rem; --padding-start: 0.5rem; --padding-end: 0.5rem;">
              <ion-icon name="location-outline" slot="start"></ion-icon>
              Utiliser ma position actuelle
            </ion-button> -->
         

          <ion-item style="--padding-start: 0; margin-bottom: 1rem;">
            <ion-label position="stacked" style="color: #232323; font-weight: 500; margin-bottom: 0.5rem;">Choisir une date</ion-label>
             <ion-datetime presentation="date-time" [preferWheel]="true"></ion-datetime>
          </ion-item>

         
        </div>
      }
    </form>
  </div>

  <div style="padding: 1rem; display: flex; gap: 1rem;">
      @if (currentStep > 1) {
        <ion-button fill="outline" expand="block" (click)="previousStep()" style="flex: 1;" color="primary">
          Retour
        </ion-button>
      }
      <ion-button expand="block" (click)="nextStep()" style="flex: 1;" color="primary">
        {{currentStep < 3 ? 'Suivant' : 'Soumettre'}}
      </ion-button>
    </div>
</ion-content>


    
 